import{_ as a,c as i,o as e,ag as n}from"./chunks/framework.C78-raJP.js";const l="/assets/verdaccio.oTaP6F7-.png",p="/assets/img.CrZMorYD.png",g=JSON.parse('{"title":"搭建前端私有npm仓库","description":"","frontmatter":{},"headers":[],"relativePath":"docs/notes/verdaccio.md","filePath":"docs/notes/verdaccio.md","lastUpdated":1749187958000}'),t={name:"docs/notes/verdaccio.md"};function h(d,s,c,o,k,r){return e(),i("div",null,s[0]||(s[0]=[n('<h1 id="搭建前端私有npm仓库" tabindex="-1">搭建前端私有npm仓库 <a class="header-anchor" href="#搭建前端私有npm仓库" aria-label="Permalink to &quot;搭建前端私有npm仓库&quot;">​</a></h1><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>随着公司前端项目越来越多，出现了很多可复用的业务组件和逻辑。为了提升开发效率和方便维护，避免每次都要在项目之间复制粘贴相同的逻辑，我们可以把可复用的组件和逻辑封装成npm包，通过npm包的形式来引入，但又由于是公司内部的业务，所以一般不希望发布到全球公共的 <code>www.npmjs.com</code> 仓库中，此时就需要搭建属于我们自己的 <code>私有npm仓库</code>。</p><h2 id="verdaccio-介绍" tabindex="-1">Verdaccio 介绍 <a class="header-anchor" href="#verdaccio-介绍" aria-label="Permalink to &quot;Verdaccio 介绍&quot;">​</a></h2><img src="'+l+'" alt="Verdaccio" style="margin:32px auto;"><p>Verdaccio 是一款轻量级的私有 npm 仓库管理器，支持在本地搭建一个私有 npm 仓库并管理自己的 Node.js 包。它可以让开发人员和团队在内部使用自己的 npm 包，而不必将这些包发布到公共 npm 仓库上。</p><p>Verdaccio 基于 Node.js 和 JavaScript 编写，并提供了多种配置选项以满足不同场景下的需求。它支持常见的 npm 命令（如 install、publish 等），并具有与公共 npm registry 相同的 API。</p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><blockquote><p>nodejs 版本需要大于16.0</p></blockquote><p>使用 <code>npm</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> instasll</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --location=global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  verdaccio@6-next</span></span></code></pre></div><p>使用 <code>yarn</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio@6-next</span></span></code></pre></div><p>使用 <code>pnpm</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio@6-next</span></span></code></pre></div><p>或者使用 <code>docker</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio/verdaccio:nightly-master</span></span></code></pre></div><h3 id="启动verdaccio" tabindex="-1">启动verdaccio <a class="header-anchor" href="#启动verdaccio" aria-label="Permalink to &quot;启动verdaccio&quot;">​</a></h3><p>安装好后 我们需要先进入安装路径，/verdaccio/config.yaml 将文件中的 <code>listen: localhost:4873</code> 修改为 <code>listen: 0.0.0.0:4873</code> ,不然不能通过外网访问。 PS：如果使用本地可以不修改。</p><p>然后启动 verdaccio</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio</span></span></code></pre></div><p>启动好后就可以通过ip+端口号访问了。PS：本地通过localhost访问,如果在服务器上启动后，访问不了，需要检查端口是否开放。</p><p><img src="'+p+`" alt="img.png"></p><h3 id="使用pm2守护进程" tabindex="-1">使用PM2守护进程 <a class="header-anchor" href="#使用pm2守护进程" aria-label="Permalink to &quot;使用PM2守护进程&quot;">​</a></h3><p>这里有个问题：在启动verdaccio后，关闭窗口后verdaccio就会停止。但是我们不可能一直开着窗口。所以这里需要使用 <code>pm2</code> 来 进行进程守护。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#pm2 建立软链</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/app/nodejs/bin/pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   /usr/local/bin/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pm2 启动verdaccio</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#停止verdaccio</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pm2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio</span></span></code></pre></div><h3 id="发布npm包" tabindex="-1">发布npm包 <a class="header-anchor" href="#发布npm包" aria-label="Permalink to &quot;发布npm包&quot;">​</a></h3><p>这里推荐使用 <code>nrm</code> 来管理仓库地址。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置新的仓库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nrm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://xxx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#查看列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nrm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#使用新的仓库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nrm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#发布新的包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> publish</span></span></code></pre></div><h3 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><ol><li>默认端口号：verdaccio使用 <code>4873</code> 作为其默认端口号。</li><li>默认所有用户都可以访问，并且进行包的操作。如需生产使用，还需要配置权限。</li><li>需要相应的修改 <code>CI/CD</code> 流程中的包地址。</li><li>verdaccio支持 <code>webhooks</code>，如有需要可以接入钉钉/企业微信机器人，发布包时候将会通知。</li></ol>`,31)]))}const m=a(t,[["render",h]]);export{g as __pageData,m as default};
